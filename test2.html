<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script src="public/scripts/event.js"></script>
  <script src="public/scripts/util.js"></script>
  <script src="public/scripts/point.js"></script>
  <script src="public/scripts/map.js"></script>
  <script src="public/scripts/rack.js"></script>
  <script src="public/scripts/user.js"></script>
  <script src="public/scripts/engine.js"></script>
  <style>
    tr, td {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
<table id="map"></table>
<script>
  var engine = new Engine();

  var table = document.getElementById('map');
  var map = engine.map;
  function render() {
    table.innerHTML = "";
    for (var i = 0; i < map.length; i++) {
      var tr = document.createElement('tr');
      for (var j = 0; j < map.length; j++) {
        var td = document.createElement('td');
        var point = map.get(i, j);
        if (!!point.rack) {
          td.style.color = "red";
          td.innerHTML = 'R';
        } else if (!!point.chip) {
          if (point.chip == 5) {
            td.style.color = "yellow";
          } else if (point.chip == 3) {
            td.style.color = "silver";
          } else {
            td.style.color = "black";
            td.style.fontWeight = "bold";
          }
          td.innerHTML = 'C';
        } else {
          td.innerHTML = point.num;
        }

        tr.appendChild(td);
      }
      table.appendChild(tr);
    }
  }

  function timeoutRender() {
    var fns = [].slice.call(arguments);

    setTimeout(function () {
      fns[0]();
      fns.shift();
      if (fns.length) timeoutRender.apply(window, fns);
    }, 4000);
  }


  var redRack = new Rack(10, 'red');
  var greenRack = new Rack(10, 'green');

  render();

  timeoutRender(
    function () {
      engine.putRack(redRack, [5, 4]);
      render();
    },
    function () {
      engine.moveRack(redRack, map.get(5, 5));
      render();
    },
    function () {
      engine.solveConflict(map.get(5, 5), map.get(4, 4));
      render();
    },
    function () {
      engine.solveConflict(map.get(5, 4), map.get(6, 4));
      render();
    },
    function () {
      engine.putRack(greenRack, [4, 7]);
      render();
    },
    function () {
      engine.moveRack(greenRack, map.get(5, 6));
      render();
    },
    function () {
      engine.solveConflict(map.get(6, 6), map.get(6, 7));
      render();
    },
    function () {
      engine.solveConflict(map.get(6, 5), map.get(6, 6));
      render();
    },
    function () {
      engine.solveConflict(map.get(6, 7), map.get(6, 8));
      render();
    }
  );
</script>
</body>
</html>
